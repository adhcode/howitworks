<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: #22c55e; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
        button {
            background: #703BF7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5a2fd4;
        }
        pre {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 400px;
        }
        .property-card {
            border: 1px solid #e5e7eb;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <h1>üîç Frontend API Connection Test</h1>
    
    <div class="test-section">
        <h2>1. Test Public Endpoints (No Auth)</h2>
        <button onclick="testFeaturedProperties()">Test Featured Properties</button>
        <button onclick="testAllProperties()">Test All Properties</button>
        <div id="public-results"></div>
    </div>

    <div class="test-section">
        <h2>2. Test Admin Login</h2>
        <input type="email" id="email" value="admin@example.com" placeholder="Email">
        <input type="password" id="password" value="admin123" placeholder="Password">
        <button onclick="testLogin()">Login</button>
        <div id="login-results"></div>
    </div>

    <div class="test-section">
        <h2>3. Test Authenticated Endpoints</h2>
        <button onclick="testAdminProperties()">Test Admin Properties</button>
        <button onclick="testCreateProperty()">Create Test Property</button>
        <div id="auth-results"></div>
    </div>

    <div class="test-section">
        <h2>4. Display Properties</h2>
        <div id="properties-display"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:3004/api';
        let authToken = localStorage.getItem('access_token');

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            element.innerHTML += `<p class="${className}">${message}</p>`;
        }

        function logJson(elementId, data) {
            const element = document.getElementById(elementId);
            element.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        async function testFeaturedProperties() {
            const resultsDiv = document.getElementById('public-results');
            resultsDiv.innerHTML = '<p class="info">Testing featured properties endpoint...</p>';
            
            try {
                const response = await fetch(`${API_URL}/properties/featured`);
                console.log('Featured properties response:', response);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                log('public-results', `‚úÖ Success! Found ${data.length} featured properties`, 'success');
                logJson('public-results', data);
                
                displayProperties(data);
            } catch (error) {
                log('public-results', `‚ùå Error: ${error.message}`, 'error');
                console.error('Featured properties error:', error);
            }
        }

        async function testAllProperties() {
            const resultsDiv = document.getElementById('public-results');
            resultsDiv.innerHTML = '<p class="info">Testing all properties endpoint...</p>';
            
            try {
                const response = await fetch(`${API_URL}/properties?page=1&limit=10`);
                console.log('All properties response:', response);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                log('public-results', `‚úÖ Success! Found ${data.properties?.length || 0} properties`, 'success');
                logJson('public-results', data);
                
                if (data.properties) {
                    displayProperties(data.properties);
                }
            } catch (error) {
                log('public-results', `‚ùå Error: ${error.message}`, 'error');
                console.error('All properties error:', error);
            }
        }

        async function testLogin() {
            const resultsDiv = document.getElementById('login-results');
            resultsDiv.innerHTML = '<p class="info">Attempting login...</p>';
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                console.log('Login response:', response);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP ${response.status}`);
                }
                
                const data = await response.json();
                authToken = data.access_token;
                localStorage.setItem('access_token', authToken);
                
                log('login-results', '‚úÖ Login successful!', 'success');
                log('login-results', `Token: ${authToken.substring(0, 20)}...`, 'info');
                logJson('login-results', data.user);
            } catch (error) {
                log('login-results', `‚ùå Error: ${error.message}`, 'error');
                console.error('Login error:', error);
            }
        }

        async function testAdminProperties() {
            const resultsDiv = document.getElementById('auth-results');
            resultsDiv.innerHTML = '<p class="info">Testing admin properties endpoint...</p>';
            
            if (!authToken) {
                log('auth-results', '‚ùå Please login first!', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/properties?page=1&limit=10`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('Admin properties response:', response);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                log('auth-results', `‚úÖ Success! Found ${data.properties?.length || 0} properties`, 'success');
                logJson('auth-results', data);
                
                if (data.properties) {
                    displayProperties(data.properties);
                }
            } catch (error) {
                log('auth-results', `‚ùå Error: ${error.message}`, 'error');
                console.error('Admin properties error:', error);
            }
        }

        async function testCreateProperty() {
            const resultsDiv = document.getElementById('auth-results');
            resultsDiv.innerHTML = '<p class="info">Creating test property...</p>';
            
            if (!authToken) {
                log('auth-results', '‚ùå Please login first!', 'error');
                return;
            }
            
            const propertyData = {
                title: `Test Property ${Date.now()}`,
                description: 'Created from frontend test',
                price: 35000000,
                location: 'Lagos, Nigeria',
                bedrooms: 3,
                bathrooms: 2,
                area: 180,
                propertyType: 'Apartment',
                listingType: 'sale',
                status: 'active',
                featured: false
            };
            
            try {
                const response = await fetch(`${API_URL}/properties`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(propertyData)
                });
                
                console.log('Create property response:', response);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP ${response.status}`);
                }
                
                const data = await response.json();
                log('auth-results', '‚úÖ Property created successfully!', 'success');
                logJson('auth-results', data);
            } catch (error) {
                log('auth-results', `‚ùå Error: ${error.message}`, 'error');
                console.error('Create property error:', error);
            }
        }

        function displayProperties(properties) {
            const displayDiv = document.getElementById('properties-display');
            displayDiv.innerHTML = '<h3>Properties:</h3>';
            
            if (!properties || properties.length === 0) {
                displayDiv.innerHTML += '<p>No properties to display</p>';
                return;
            }
            
            properties.forEach(property => {
                const card = document.createElement('div');
                card.className = 'property-card';
                card.innerHTML = `
                    <h4>${property.title}</h4>
                    <p><strong>Price:</strong> ‚Ç¶${property.price.toLocaleString()}</p>
                    <p><strong>Location:</strong> ${property.location}</p>
                    <p><strong>Type:</strong> ${property.propertyType}</p>
                    <p><strong>Beds:</strong> ${property.bedrooms} | <strong>Baths:</strong> ${property.bathrooms}</p>
                    <p><strong>Status:</strong> ${property.status} ${property.featured ? '‚≠ê Featured' : ''}</p>
                    <p><strong>ID:</strong> ${property.id}</p>
                `;
                displayDiv.appendChild(card);
            });
        }

        // Check if already logged in
        if (authToken) {
            log('login-results', '‚úÖ Already logged in (token found in localStorage)', 'success');
        }
    </script>
</body>
</html>
